name: Publicar Reto del Día (Producción)
on:
  schedule:
    - cron: '30 5 * * 1-5'
  workflow_dispatch:
jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout de la rama main
        uses: actions/checkout@v4
        with: { ref: 'main' }
      - name: Checkout de la rama develop
        uses: actions/checkout@v4
        with: { ref: 'develop', path: 'develop' }
      - name: Copiar reto y actualizar lista
        run: |
          FECHA_HOY=$(date +'%Y-%m-%d')
          ARCHIVO_RETO_FUTURO="develop/retos/${FECHA_HOY}.json"
          
          if [ -f "$ARCHIVO_RETO_FUTURO" ]; then
            echo "✅ Reto para hoy encontrado. Publicando..."
            cp "$ARCHIVO_RETO_FUTURO" "reto.json"
            
            # Copiar la lista de retos actualizada desde develop
            if [ -f "develop/lista_retos.json" ]; then
              cp "develop/lista_retos.json" "lista_retos.json"
            fi
          else
            echo "❌ No se encontró reto para hoy. La web no se actualizará."
            # Creamos una variable para saltar el commit si no hay reto
            echo "NO_COMMIT=true" >> $GITHUB_ENV
          fi
      - name: Guardar y publicar en main
        if: env.NO_COMMIT != 'true'
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add reto.json lista_retos.json
          git commit -m "🚀 Publicado el reto del día $(date +'%Y-%m-%d')"
          git push