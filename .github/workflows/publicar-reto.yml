name: Publicar Reto Diario

on:
  # Se activa de Lunes a Viernes a las 06:05 UTC (08:05 en España)
  schedule:
    - cron: "5 6 * * 1-5"
  
  # Permite activarlo manualmente desde la pestaña "Actions" de GitHub
  workflow_dispatch: {}

jobs:
  publicar:
    runs-on: ubuntu-latest
    steps:
      # Paso 1: Descarga la última versión de tu código de la rama 'main'
      - name: Checkout del repositorio
        uses: actions/checkout@v4
        with:
          ref: 'main'

      # Paso 2: Configura Python
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # Paso 3: Instala las librerías de tu archivo requirements.txt
      - name: Instalar dependencias
        run: pip install -r requirements.txt

      # Paso 4: Ejecuta tu script de Python (el bueno, el que ya tienes)
      - name: Ejecutar la lógica de publicación
        run: python3 reto_diario.py
      
      # Paso 5: Sube los cambios (el nuevo reto.json y el reto movido)
      - name: Guardar y subir los cambios a GitHub
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          # Comprueba si hay algún cambio. Si no hay, no hace nada.
          if git diff --quiet && git diff --staged --quiet; then
            echo "No hay cambios para subir."
          else
            git add .
            git commit -m "🚀 Reto del día publicado automáticamente"
            git push
          fi
