name: Generar Lote de Retos (Manual)

on:
  # Esto permite que lo actives manualmente desde la pesta√±a "Actions"
  workflow_dispatch:
    inputs:
      retos_por_categoria:
        description: '¬øCu√°ntos retos generar por cada categor√≠a?'
        required: true
        default: '5'

jobs:
  generate-batch:
    runs-on: ubuntu-latest
    steps:
      # 1. Descarga el c√≥digo de la rama 'develop' donde est√° el almac√©n
      - name: Checkout de la rama develop
        uses: actions/checkout@v4
        with:
          ref: 'develop'

      # 2. Configura el entorno de Python
      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # 3. Instala las librer√≠as necesarias
      - name: Instalar dependencias
        run: pip install google-generativeai firebase-admin

      # 4. Ejecuta el script de Python en modo "lote"
      - name: Ejecutar script de generaci√≥n en lote
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          FIREBASE_CREDS: ${{ secrets.FIREBASE_CREDS }}
          GENERATION_MODE: 'bulk'
          COUNT_PER_CATEGORY: ${{ github.event.inputs.retos_por_categoria }}
        run: python reto_diario.py

      # 5. Guarda los nuevos retos generados en la rama 'develop'
      - name: Guardar los nuevos retos en la rama develop
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git pull
          git add almacen_retos/*
          git commit -m "ü§ñ Lote de ${{ github.event.inputs.retos_por_categoria }} retos por categor√≠a generado" || echo "No hay cambios para commitear"
          git push
